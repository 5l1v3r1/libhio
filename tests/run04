#! /bin/bash
. ./run_setup

# Invalid parameter test cases 
# Much more needed 

ro_dir="$PWD/non-writable-test-directory"

cmd mkdir $ro_dir
cmd chmod 555 $ro_dir

fails="
  name run04w v $verbose_lev d $debug_lev mi 0
  /@@ Basic successful function @/
    hi MY_CTX $HIO_TEST_ROOTS
    hdo NTN_DS 97 WRITE,CREAT UNIQUE
    heo MY_EL WRITE,CREAT,TRUNC 20Mi
    hvp c. .
    hec hdc hf

  /@@ HDO without prior init @/
    hxrc ERR_BAD_PARAM 
    hdo NT1_DS 98 WRITE,CREAT SHARED

  /@@ HI, HDO CREAT in non-writable data root directory @/
    hi MY_CTX posix:$ro_dir 
    hvp c. .
    hxrc ERR_PERM 
    hdo NTN_DS 97 WRITE,CREAT UNIQUE
    hf

  /@@ HI, HDO READ in non-existent data root directory @/
    hi MY_CTX posix:/does_not_exist 
    hvp c. .
    hxrc ERR_NOT_FOUND
    hdo NTN_DS 97 READ UNIQUE
    hf

  /@@ HI, HDO invalid data root prefix @/
    hi MY_CTX WIERD:$PWD 
    hvp c. .
    hxrc ERR_NOT_FOUND 
    hdo NTN_DS 97 WRITE,CREAT UNIQUE
    hf

  /@@ HEO without HDO @/
    hxrc ERR_BAD_PARAM 
    heo MY_EL WRITE,CREAT,TRUNC 20Mi

  /@@ HI, HDO READ non-existent DS ID  @/
    hi MY_CTX $HIO_TEST_ROOTS
    hvp c. .
    hxrc ERR_NOT_FOUND 
    hdo NTN_DS 29 READ UNIQUE
    hf

  mgf mf
"

#set -x
clean_roots $HIO_TEST_ROOTS
myrun .libs/xexec.x $fails
check_rc
cmd rmdir $ro_dir
clean_roots $HIO_TEST_ROOTS
